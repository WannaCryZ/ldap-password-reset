<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>å…¬å¸LDAPå¯†ç ç®¡ç†-å…¬å¸IT</title>
    <!-- å¼•å…¥ WeUI CDN é“¾æ¥ -->
    <link rel="stylesheet" href="./static/css/weui.min.css" />
    <link rel="stylesheet" href="./static/css/example.css" />
    <!-- æ–°å¢ jQuery å¼•ç”¨ -->
    <script src="./static/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="./static/js/weui.min.js"></script>
    <style>
        .pwd-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            opacity: 0.6;
        }

        .pwd-toggle:hover {
            opacity: 1;
        }
    </style>
</head>

<body>
    <!-- ä½¿ç”¨ -->
    <div class="page js_show" tabindex="-1">
        <div class="weui-form">
            <div class="weui-form__bd">
                <div class="weui-form__text-area">
                    <h2 class="weui-form__title">å…¬å¸LDAPå¯†ç ç®¡ç†</h2>
                    <div class="weui-form__desc">å¯†ç ä¿®æ”¹</div>
                </div>
                <div class="weui-form__control-area">
                    <div class="weui-cells__group weui-cells__group_form">
                        <div class="weui-cells__title">é»˜è®¤LDAPè´¦å·ä¸ºä¼ä¸šé‚®ç®±å‰ç¼€ï¼Œå¦‚é‚®ç®±ä¸ºdemo@example.comï¼Œåˆ™è´¦å·ä¸ºdemo</div>
                        <div class="weui-cells">
                            <label for="js_input1" class="weui-cell weui-cell_active weui-cell_readonly">
                                <div class="weui-cell__hd"><span class="weui-label">è´¦å·</span></div>
                                <div class="weui-cell__bd">
                                    <input id="js_input1" class="weui-input" placeholder="å¡«å†™LDAPè´¦å·" required/>
                                </div>
                            </label>
                            <label for="js_input3" class="weui-cell weui-cell_active">
                              <div class="weui-cell__hd"><span class="weui-label" lang="en">æ—§å¯†ç </span></div>
                              <div class="weui-cell__bd">
                                  <input id="js_input3" class="weui-input" placeholder="å¡«å†™æ—§å¯†ç " type="password" required />
                                  <span class="pwd-toggle" onclick="togglePassword('js_input3', this)">ğŸ‘ï¸</span>
                              </div>
                          </label>
                            <label for="js_input4" class="weui-cell weui-cell_active">
                                <div class="weui-cell__hd"><span class="weui-label" lang="en">æ–°å¯†ç </span></div>
                                <div class="weui-cell__bd">
                                    <input id="js_input4" class="weui-input" placeholder="å¡«å†™æ–°å¯†ç " type="password" required pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼Œä¸”é•¿åº¦è¶…è¿‡8ä½" />
                                    <span class="pwd-toggle" onclick="togglePassword('js_input4', this)">ğŸ‘ï¸</span>
                                </div>
                            </label>
                            
                            <div role="alert" id="js_complex_tips" style="display: none;" class="weui-cells__tips weui-cells__tips_warn">å¯†ç éœ€åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ç»„åˆï¼Œä¸”é•¿åº¦è¶…è¿‡8ä½</div>
                            <label for="js_input5" class="weui-cell weui-cell_active">
                                <div class="weui-cell__hd"><span class="weui-label" lang="en">ç¡®è®¤æ–°å¯†ç </span></div>
                                <div class="weui-cell__bd">
                                    <input id="js_input5" class="weui-input" placeholder="å†æ¬¡å¡«å†™æ–°å¯†ç " type="password" required data-rule-equalto="#js_input4" />
                                    <span class="pwd-toggle" onclick="togglePassword('js_input5', this)">ğŸ‘ï¸</span>
                                </div>
                            </label>
                            <div role="alert" id="js_current_tips" style="display: none;" class="weui-cells__tips weui-cells__tips_warn">ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸åŒ¹é…</div>
                            
                        </div>

                    </div>
                </div>
            </div>
            <div class="weui-form__ft">
              <div class="weui-form__tips-area">
                <label id="weuiAgree" for="weuiAgreeCheckbox" class="weui-agree weui-wa-hotarea">
                    <input id="weuiAgreeCheckbox" type="checkbox" class="weui-agree__checkbox" /><span
                        class="weui-agree__text">é˜…è¯»å¹¶äº†è§£<a href="./view/policy.html" target="_blank">ã€Šå…¬å¸ä¿¡æ¯å®‰å…¨ç®¡ç†é¡»çŸ¥ã€‹</a>
                    </span>
                </label>
            </div>
                <div class="weui-form__tips-area">
                    <p class="weui-form__tips">
                        è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„å¯†ç ï¼Œç¡®ä¿ä¿¡æ¯å®‰å…¨
                    </p>
                </div>
                <div class="weui-form__opr-area">
                    <button class="weui-btn weui-btn_primary" type="button" id="showTooltips" disabled>ç¡®å®š</button>
                </div>
                <div class="weui-form__tips-area">
                    <p class="weui-form__tips">
                        å¿˜è®°å¯†ç ï¼Ÿ
                        <a href="./reset.html" class="weui-form__link">
                            ç‚¹æ­¤é‡ç½®
                        </a>    
                    </p>
                </div>
                <div class="weui-form__extra-area">
                    <div class="weui-footer">
                        <p class="weui-footer__links">
                            <a href="https://it.example.com/" target="_blank" class="weui-footer__link">ç‹¼äººçš„å…¬å¸-è¿ç»´å¹³å°éƒ¨</a>
                        </p>
                        <p class="weui-footer__text">Copyright Â© 2025 it.example.com</p>
                    </div>
                </div>
            </div>
        </div>
        <div role="alert" id="js_toast" style="display: none;">
            <div class="weui-mask_transparent"></div>
            <div class="weui-toast">
                <i class="weui-icon-success-no-circle weui-icon_toast"></i>
                <p class="weui-toast__content">å·²å®Œæˆ</p>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function() {
            // è·å–æ‰€æœ‰éœ€è¦éªŒè¯çš„å…ƒç´ 
            const $username = $('#js_input1');
            const $oldPwd = $('#js_input3');
            const $newPwd = $('#js_input4');
            const $confirmPwd = $('#js_input5');
            const $submitBtn = $('#showTooltips');
            const $agreeCheckbox = $('#weuiAgreeCheckbox');

            // ç»Ÿä¸€éªŒè¯å‡½æ•°
            function validateForm() {
                // åŸºç¡€éç©ºéªŒè¯
                const isAllFilled = $username.val().trim() && 
                                  $oldPwd.val() && 
                                  $newPwd.val() && 
                                  $confirmPwd.val();
                
                // å¯†ç å¤æ‚åº¦éªŒè¯
                const hasUpperCase = /[A-Z]/.test($newPwd.val());
                const hasLowerCase = /[a-z]/.test($newPwd.val());
                const hasNumber = /\d/.test($newPwd.val());
                const isValidComplex = hasUpperCase && hasLowerCase && hasNumber;
                
                // æœ€ç»ˆéªŒè¯æ¡ä»¶
                const isValid = isAllFilled &&
                              ($newPwd.val() === $confirmPwd.val()) &&
                              ($newPwd.val().length >= 8) &&
                              isValidComplex &&
                              $agreeCheckbox.is(':checked');

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                $submitBtn.toggleClass('weui-btn_disabled', !isValid);
                $submitBtn.prop('disabled', !isValid);

                // æç¤ºä¿¡æ¯æ˜¾ç¤ºé€»è¾‘ï¼ˆä¿®æ”¹éƒ¨åˆ†ï¼‰
                const hasNewPwdInput = $newPwd.val().trim() !== '';
                const hasConfirmInput = $confirmPwd.val().trim() !== '';
                
                $('#js_complex_tips').toggle(
                    hasNewPwdInput && (!isValidComplex || $newPwd.val().length < 8)
                );
                $('#js_current_tips').toggle(
                    hasConfirmInput && $newPwd.val() !== $confirmPwd.val()
                );
            }

            // åˆå§‹åŒ–éªŒè¯
            validateForm();
            // ç›‘å¬æ‰€æœ‰è¾“å…¥äº‹ä»¶
            $username.add($oldPwd).add($newPwd).add($confirmPwd).on('input', validateForm);
            $agreeCheckbox.on('change', validateForm);

            // æ–°å¢è¡¨å•æäº¤å¤„ç†
            $('#showTooltips').on('click', function(e) {
                e.preventDefault();
                const loading = weui.loading('æäº¤ä¸­...');

                // æ”¶é›†è¡¨å•æ•°æ®
                const formData = {
                    username: $('#js_input1').val().trim(),
                    old_password: $('#js_input3').val(),
                    new_password: $('#js_input4').val(),
                    confirm_password: $('#js_input5').val(),
                };

                $.post('./function/renew_pass.php', formData)
                    .done(function(response) {
                        loading.hide();
                        if (response.success) {
                            weui.toast('å¯†ç ä¿®æ”¹æˆåŠŸ', 1500);
                            window.location.href = './view/reset_success.html';
                            // æ¸…ç©ºè¡¨å•
                            $username.val('');
                            $oldPwd.val('');
                            $newPwd.val('');
                            $confirmPwd.val('');
                            $agreeCheckbox.prop('checked', false);
                            validateForm();

                        } else {
                            weui.topTips(response.message || 'å¯†ç ä¿®æ”¹å¤±è´¥', 5000);
                        }
                    })
                    .fail(function() {
                        loading.hide();
                        weui.topTips('æœåŠ¡å™¨è¯·æ±‚å¤±è´¥ï¼Œè¯·è”ç³»ITå¤„ç†', 2000);
                    });
            });

        });

        function togglePassword(inputId, element) {
            const input = document.getElementById(inputId);
            const isPwd = input.type === 'password';
            input.type = isPwd ? 'text' : 'password';
            element.innerHTML = isPwd ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸';
        }
    </script>
</body>

</html>